---
title: "RTC Fact Sheet: 2025 State of Evictions"
format: 
  html:
    code-fold: true
---

```{r}
#| label: setup
#| include: true
#| warning: false
#| message: false

library(DBI)
library(RPostgres)
library(flextable)
library(sf)
library(tidyverse)

# Ensure that the Quarto render and RStudio read the same environment vars
readRenviron(".Renviron")

con <- dbConnect(
  RPostgres::Postgres(),
  dbname = Sys.getenv("PG_DBNAME"),
  host     = Sys.getenv("PG_HOST"),
  port     = Sys.getenv("PG_PORT"),
  user     = Sys.getenv("PG_USER"),
  password = Sys.getenv("PG_PASSWORD")
  )
```


The following analyses were performed in support of [Right to Counsel's](https://www.righttocounselnyc.org/) annual State of Evictions fact sheet. 

## Cumulative Eviction Filings

### Number of eviction filings from January 1, 2020 - December 31, 2025

```{sql connection = con, output.var = "eviction_count_df", cache=FALSE}
SELECT
  COUNT(DISTINCT indexnumberid)::integer
FROM oca_index
WHERE fileddate >= MAKE_DATE(2020,1,1) 
  AND fileddate <= MAKE_DATE(2025,12,31)
  AND classification IN ('Holdover', 'Non-Payment')
  AND (propertytype = 'Residential' OR propertytype IS NULL);
```

In New York State, there were **`r scales::comma(eviction_count_df$count)`** eviction-oriented (holdover and non-payment) filings from January 1, 2020 to December 31, 2025.

Please note that this analysis **excludes commercial evictions within New York City.** Unfortunately, outside of NYC, excluding commercial from residential eviction filings and executions is not possible given the current data.

## Annual eviction filings
```{sql connection = con, output.var = "eviction_count_annual_df", cache=FALSE}
SELECT
	EXTRACT(YEAR FROM fileddate) AS filed_year,
	COUNT(DISTINCT indexnumberid)::integer
FROM oca_index
WHERE fileddate >= MAKE_DATE(2020,1,1) 
  AND fileddate <= MAKE_DATE(2025,12,31)
  AND classification IN ('Holdover', 'Non-Payment')
  AND (propertytype = 'Residential' OR propertytype IS NULL)
GROUP BY filed_year;
```

The number of eviction-related (holdover and non-payment) eviction filings per year is:

```{r}
eviction_count_annual_table <- eviction_count_annual_df |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  set_header_labels(
    filed_year = "Year",
    count = "Eviction Filings"
  ) |> 
  colformat_num(j=1,
                big.mark = "") |> 
  align(j=1,
        align = "left",
        part = "all")

eviction_count_annual_table
```

## Which areas are hardest hit?

### By court, January 1, 2020 - December 31, 2025:

```{sql connection = con, output.var = "eviction_count_courts_df", cache=FALSE}
SELECT
	court,
	COUNT(DISTINCT indexnumberid)::integer
FROM oca_index
WHERE fileddate >= MAKE_DATE(2020,1,1) 
  AND fileddate <= MAKE_DATE(2025,12,31)
  AND classification IN ('Holdover', 'Non-Payment')
  AND (propertytype = 'Residential' OR propertytype IS NULL)
GROUP BY court
ORDER BY count DESC
LIMIT 10;
```

```{r}
eviction_count_courts_table <- eviction_count_courts_df |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  set_header_labels(
    court = "Court",
    count = "Eviction Filings"
  )

eviction_count_courts_table
```

### By court, January 1, 2025 - December 31, 2025:
```{sql connection = con, output.var = "eviction_count_courts_25_df", cache=FALSE}
SELECT
	court,
	COUNT(DISTINCT indexnumberid)::integer
FROM oca_index
WHERE fileddate >= MAKE_DATE(2025,1,1) 
  AND fileddate <= MAKE_DATE(2025,12,31)
  AND classification IN ('Holdover', 'Non-Payment')
  AND (propertytype = 'Residential' OR propertytype IS NULL)
GROUP BY court
ORDER BY count DESC
LIMIT 10;
```

```{r}
eviction_count_courts_25_table <- eviction_count_courts_25_df |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  set_header_labels(
    court = "Court",
    count = "Eviction Filings"
  )

eviction_count_courts_25_table
```

### By NYS Assembly District: January 1, 2020 - December 31, 2025

```{r, cache=FALSE}
oca_index_5year_geom <- st_read(con, query = "
SELECT DISTINCT(i.indexnumberid),
    ST_Transform(a.geom, 2263) AS geom
FROM oca_index i
JOIN oca_addresses a ON i.indexnumberid = a.indexnumberid
WHERE i.fileddate >= MAKE_DATE(2020,1,1) 
    AND i.fileddate <= MAKE_DATE(2025,12,31)
    AND i.classification IN ('Holdover', 'Non-Payment')
    AND (i.propertytype = 'Residential' OR i.propertytype IS NULL)
    AND a.geom IS NOT NULL")
```

*In the following filing counts by area, note that only `r scales::comma(nrow(oca_index_5year_geom))` eviction filings (`r round((nrow(oca_index_5year_geom)/eviction_count_df$count*100),2)`%) have a location*

```{r, cache=FALSE}
bb <- read_sf("https://services5.arcgis.com/GfwWNkhOj9bNBqoJ/arcgis/rest/services/NYC_Borough_Boundary/FeatureServer/0/query?where=1=1&outFields=*&outSR=4326&f=pgeojson") |> 
  st_transform(2263) |> 
  st_make_valid() |> 
  st_union()

nysad <- read_sf("https://services6.arcgis.com/EbVsqZ18sv1kVJ3k/ArcGIS/rest/services/NYS_Assembly_Districts/FeatureServer/0/query?where=0%3D0&outFields=*&f=geojson") |> 
  st_transform(2263)

nyss <- read_sf("https://services6.arcgis.com/EbVsqZ18sv1kVJ3k/ArcGIS/rest/services/NYS_Senate_Districts/FeatureServer/0/query?where=0%3D0&outFields=*&f=geojson") |> 
  st_transform(2263)

nysad_downstate <- st_filter(nysad, bb, .predicate = st_intersects)

nysad_upstate <- st_filter(nysad, bb, .predicate = st_disjoint)

nyss_downstate <- st_filter(nyss, bb, .predicate = st_intersects)
  
nyss_upstate <- st_filter(nyss, bb, .predicate = st_disjoint)
```

#### Upstate Assembly Districts (Not intersecting with NYC Borough boundaries)
```{r, cache=FALSE}
nysad_upstate_5year <- oca_index_5year_geom |> 
  st_join(nysad_upstate |> 
              select(District),
            left = FALSE) |> 
  st_drop_geometry() |> 
  group_by(District) |> 
  summarize(`Eviction Filings` = n()) |> 
  arrange(desc(`Eviction Filings`)) |> 
  head(10)

nysad_upstate_5year_table <- nysad_upstate_5year |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  align(j=1,
        align = "left",
        part = "all")

nysad_upstate_5year_table
```

#### Downstate Assembly Districts (Intersecting with NYC Borough boundaries)
```{r, cache=FALSE}
nysad_downstate_5year <- oca_index_5year_geom |> 
  st_join(nysad_downstate |> 
              select(District),
            left = FALSE) |> 
  st_drop_geometry() |> 
  group_by(District) |> 
  summarize(`Eviction Filings` = n()) |> 
  arrange(desc(`Eviction Filings`)) |> 
  head(10)

nysad_downstate_5year_table <- nysad_downstate_5year |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  align(j=1,
        align = "left",
        part = "all")

nysad_downstate_5year_table
```

### By NYS Assembly District: January 1, 2025 - December 31, 2025
```{r, cache=FALSE}
oca_index_1year_geom <- st_read(con, query = "
SELECT DISTINCT(i.indexnumberid),
    ST_Transform(a.geom, 2263) AS geom
FROM oca_index i
JOIN oca_addresses a ON i.indexnumberid = a.indexnumberid
WHERE i.fileddate >= MAKE_DATE(2025,1,1) 
    AND i.fileddate <= MAKE_DATE(2025,12,31)
    AND i.classification IN ('Holdover', 'Non-Payment')
    AND (i.propertytype = 'Residential' OR i.propertytype IS NULL)
    AND a.geom IS NOT NULL")
```

#### Upstate Assembly Districts (Not intersecting with NYC Borough boundaries)
```{r, cache=FALSE}
nysad_upstate_1year <- oca_index_1year_geom |> 
  st_join(nysad_upstate |> 
              select(District),
            left = FALSE) |> 
  st_drop_geometry() |> 
  group_by(District) |> 
  summarize(`Eviction Filings` = n()) |> 
  arrange(desc(`Eviction Filings`)) |> 
  head(10)

nysad_upstate_1year_table <- nysad_upstate_1year |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  align(j=1,
        align = "left",
        part = "all")

nysad_upstate_1year_table
```

#### Downstate Assembly Districts (Intersecting with NYC Borough boundaries)
```{r, cache=FALSE}
nysad_downstate_1year <- oca_index_1year_geom |> 
  st_join(nysad_downstate |> 
              select(District),
            left = FALSE) |> 
  st_drop_geometry() |> 
  group_by(District) |> 
  summarize(`Eviction Filings` = n()) |> 
  arrange(desc(`Eviction Filings`)) |> 
  head(10)

nysad_downstate_1year_table <- nysad_downstate_1year |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  align(j=1,
        align = "left",
        part = "all")

nysad_downstate_1year_table
```

### By NYS Senate District, January 1, 2020 - December 31, 2025

#### Upstate Senate Districts (Not intersecting with NYC Borough boundaries)
```{r, cache=FALSE}
nyss_upstate_5year <- oca_index_5year_geom |> 
  st_join(nyss_upstate |> 
              select(DISTRICT),
            left = FALSE) |> 
  st_drop_geometry() |> 
  group_by(DISTRICT) |> 
  summarize(`Eviction Filings` = n()) |> 
  arrange(desc(`Eviction Filings`)) |> 
  head(10)

nyss_upstate_5year_table <- nyss_upstate_5year |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  align(j=1,
        align = "left",
        part = "all") |> 
  set_header_labels(
    DISTRICT = "District"
  )

nyss_upstate_5year_table
```

#### Downstate Senate Districts (Intersecting with NYC Borough boundaries)
```{r, cache=FALSE}
nyss_downstate_5year <- oca_index_5year_geom |> 
  st_join(nyss_downstate |> 
              select(DISTRICT),
            left = FALSE) |> 
  st_drop_geometry() |> 
  group_by(DISTRICT) |> 
  summarize(`Eviction Filings` = n()) |> 
  arrange(desc(`Eviction Filings`)) |> 
  head(10)

nyss_downstate_5year_table <- nyss_downstate_5year |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  align(j=1,
        align = "left",
        part = "all") |> 
  set_header_labels(
    DISTRICT = "District"
  )

nyss_downstate_5year_table
```

### By NYS Senate District, January 1, 2025 - December 31, 2025
#### Upstate Senate Districts (Not intersecting with NYC Borough boundaries)
```{r, cache=FALSE}
nyss_upstate_1year <- oca_index_1year_geom |> 
  st_join(nyss_upstate |> 
              select(DISTRICT),
            left = FALSE) |> 
  st_drop_geometry() |> 
  group_by(DISTRICT) |> 
  summarize(`Eviction Filings` = n()) |> 
  arrange(desc(`Eviction Filings`)) |> 
  head(10)

nyss_upstate_1year_table <- nyss_upstate_1year |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  align(j=1,
        align = "left",
        part = "all") |> 
  set_header_labels(
    DISTRICT = "District"
  )

nyss_upstate_1year_table
```

#### Downstate Senate Districts (Intersecting with NYC Borough boundaries)
```{r, cache=FALSE}
nyss_downstate_1year <- oca_index_1year_geom |> 
  st_join(nyss_downstate |> 
              select(DISTRICT),
            left = FALSE) |> 
  st_drop_geometry() |> 
  group_by(DISTRICT) |> 
  summarize(`Eviction Filings` = n()) |> 
  arrange(desc(`Eviction Filings`)) |> 
  head(10)

nyss_downstate_1year_table <- nyss_downstate_1year |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  align(j=1,
        align = "left",
        part = "all") |> 
  set_header_labels(
    DISTRICT = "District"
  )

nyss_downstate_1year_table
```

### Executed Evictions in 2025
```{sql, connection = con, output.var="executed_evictions_25", cache=FALSE}
SELECT
  DISTINCT i.indexnumberid,
  w.executiondate
FROM oca_index i
JOIN oca_warrants w ON i.indexnumberid = w.indexnumberid
WHERE w.executiondate >= MAKE_DATE(2025,1,1) 
  AND w.executiondate <= MAKE_DATE(2025,12,31)
  AND i.classification IN ('Holdover', 'Non-Payment')
  AND (i.propertytype = 'Residential' OR i.propertytype IS NULL)
  AND w.executiondate IS NOT NULL
```

```{r, cache=FALSE}
executed_evictions_25_geom <- st_read(con, query = "
WITH executed_evictions_25 AS (
	SELECT
	  DISTINCT i.indexnumberid,
	  w.executiondate
	FROM oca_index i
	JOIN oca_warrants w ON i.indexnumberid = w.indexnumberid
	WHERE w.executiondate >= MAKE_DATE(2025,1,1) 
	  AND w.executiondate <= MAKE_DATE(2025,12,31)
	  AND i.classification IN ('Holdover', 'Non-Payment')
	  AND (i.propertytype = 'Residential' OR i.propertytype IS NULL)
	  AND w.executiondate IS NOT NULL
)
SELECT e.*,
	ST_TRANSFORM(a.geom, 2263)
FROM executed_evictions_25 e
JOIN oca_addresses a on e.indexnumberid = a.indexnumberid
WHERE a.geom IS NOT NULL;")
```
Note: Of the `r scales::comma(nrow(executed_evictions_25))` evictions executed statewide in 2025, only `r scales::comma(nrow(executed_evictions_25_geom))` have a location associated with them (`r round((nrow(executed_evictions_25_geom)/nrow(executed_evictions_25)*100),2)`%)

``` {r, cache=FALSE}
nys_counties <- read_sf("https://services6.arcgis.com/EbVsqZ18sv1kVJ3k/ArcGIS/rest/services/NYS_Civil_Boundaries/FeatureServer/2/query?where=0%3D0&outFields=*&f=geojson") |> 
  st_transform(2263)

executed_evictions_25_byCty <- executed_evictions_25_geom |> 
  st_join(nys_counties |> 
            select(NAME)) |> 
  st_drop_geometry() |> 
  group_by(NAME) |> 
  summarize(`Executed Evictions` = n()) |> 
  arrange(desc(`Executed Evictions`)) |> 
  head(10)

executed_evictions_25_byCty_table <- executed_evictions_25_byCty |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  align(j=1,
        align = "left",
        part = "all") |> 
  set_header_labels(
    NAME = "County"
  )

executed_evictions_25_byCty_table
```


### Evictions During the Winter Months (November 1 - April 15)

#### Eviction filings
```{sql, connection=con, output.var="winter_filings", cache=FALSE}
WITH eviction_filings_with_season AS(
	SELECT
		DISTINCT indexnumberid,
		EXTRACT(YEAR FROM fileddate) AS filed_year,
		CASE 
	        WHEN EXTRACT(MONTH FROM fileddate) >= 11 THEN TRUE
	        WHEN EXTRACT(MONTH FROM fileddate) < 4 THEN TRUE
	        WHEN EXTRACT(MONTH FROM fileddate) = 4 
	             AND EXTRACT(DAY FROM fileddate) <= 15 THEN TRUE
	        ELSE FALSE
	    END AS winter_season
	FROM oca_index
	WHERE fileddate >= MAKE_DATE(2020,1,1) 
	  AND fileddate <= MAKE_DATE(2025,12,31)
	  AND classification IN ('Holdover', 'Non-Payment')
	  AND (propertytype = 'Residential' OR propertytype IS NULL)
)
SELECT
	filed_year,
	COUNT(indexnumberid) AS all_filings,
	SUM(winter_season::int) AS winter_filings,
	100* ROUND(SUM(winter_season::int)::numeric/COUNT(indexnumberid),3) AS winter_filing_pct
FROM eviction_filings_with_season
GROUP BY filed_year
ORDER BY filed_year;
```

```{r}
winter_filings_table <- winter_filings |> 
  # Convert from Postgres int64
  mutate(
    all_filings = as.numeric(all_filings),
    winter_filings = as.numeric(winter_filings)
  ) |> 
  flextable() |> 
  set_table_properties(width = 1, layout = "autofit") |> 
  set_header_labels(
    filed_year = "Year",
    all_filings = "Annual Filings",
    winter_filings = "Winter Filings",
    winter_filing_pct = "Winter Filing Percentage (%)"
  ) |> 
  colformat_num(j=1,
                big.mark = "") |> 
  colformat_int(j=2:3,
                big.mark = ",") |> 
  align(j=1,
      align = "left",
      part = "all")

winter_filings_table
```

#### Executed evictions
```{sql, connection=con, output.var="winter_executions", cache=FALSE}
WITH eviction_exc_with_season AS(
	SELECT
		DISTINCT i.indexnumberid,
		EXTRACT(YEAR FROM w.executiondate) AS executed_year,
		CASE 
	        WHEN EXTRACT(MONTH FROM w.executiondate) >= 11 THEN TRUE
	        WHEN EXTRACT(MONTH FROM w.executiondate) < 4 THEN TRUE
	        WHEN EXTRACT(MONTH FROM w.executiondate) = 4 
	             AND EXTRACT(DAY FROM w.executiondate) <= 15 THEN TRUE
	        ELSE FALSE
	    END AS winter_season
	FROM oca_index i
	JOIN oca_warrants w on i.indexnumberid=w.indexnumberid
	WHERE w.executiondate >= MAKE_DATE(2020,1,1) 
	  AND w.executiondate <= MAKE_DATE(2025,12,31)
	  AND i.classification IN ('Holdover', 'Non-Payment')
	  AND (i.propertytype = 'Residential' OR i.propertytype IS NULL)
)
SELECT
	executed_year,
	COUNT(indexnumberid) AS all_executions,
	SUM(winter_season::int) AS winter_executions,
	100* ROUND(SUM(winter_season::int)::numeric/COUNT(indexnumberid),3) AS winter_execution_pct
FROM eviction_exc_with_season
GROUP BY executed_year
ORDER BY executed_year;	
```


```{r}
winter_executions_table <- winter_executions |> 
  mutate(all_executions = as.numeric(all_executions),
         winter_executions = as.numeric(winter_executions)
        ) |>
  flextable() |>
  set_table_properties(width = 1, layout = "autofit") |> 
  set_header_labels(
    executed_year = "Year",
    all_executions = "Annual Executions",
    winter_executions = "Winter Executions",
    winter_execution_pct = "Winter Execution Percentage (%)"
  ) |> 
  colformat_num(j=1,
                big.mark = "") |> 
  colformat_int(j=2:3,
                big.mark = ",") |> 
  align(j=1,
      align = "left",
      part = "all")
  
winter_executions_table 
```

